<div class="obra-detail-container">
  <button (click)="goBack()" class="btn-back">← Voltar para Obras</button>
  <h2>Detalhes da Obra</h2>

  <div *ngIf="obra && !loading" class="progress-bar-container">
    <div class="progress-bar-label">Progresso Geral: {{ progress | number:'1.0-0' }}%</div>
    <div class="progress-bar">
      <div class="progress-bar-fill" [style.width.%]="progress"></div>
    </div>
  </div>

  <div class="custom-tab-menu">
    <button (click)="selectTab('Dados Básicos')" [class.active]="currentTab === 'Dados Básicos'">Dados Básicos</button>
    <button (click)="selectTab('Responsáveis')" [class.active]="currentTab === 'Responsáveis'">Responsáveis</button>
    <button (click)="selectTab('Status')" [class.active]="currentTab === 'Status'">Status</button>
    <button (click)="selectTab('Manutenção')" [class.active]="currentTab === 'Manutenção'">Manutenção</button>
    <button (click)="selectTab('Diário')" [class.active]="currentTab === 'Diário'">Diário</button>
    <button (click)="selectTab('Documentos')" [class.active]="currentTab === 'Documentos'">Documentos</button>
  </div>

  <div *ngIf="loading" class="loading-message">Carregando detalhes da obra...</div>
  <div *ngIf="error" class="error-message">{{ error }}</div>

  <div *ngIf="obra && !loading" class="card obra-details-card">
    <div *ngIf="currentTab === 'Dados Básicos'" class="detail-section">
      <h3>Dados Básicos</h3>
      <p><strong>Nome:</strong> {{ obra.nome }}</p>
      <p><strong>Localização:</strong> {{ obra.localizacao }}</p>
      <p><strong>Contratante:</strong> {{ obra.contratante }}</p>
      <p><strong>Contrato:</strong> {{ obra.contrato }}</p>
      <p><strong>Ordem de Início de Serviço:</strong> {{ obra.ordemInicioServico }}</p>
      <p><strong>Coordenador:</strong> {{ obra.coordenadorNome }}</p>
      <p><strong>Administrador:</strong> {{ obra.administradorNome }}</p>
      <p><strong>Observações:</strong> {{ obra.observacoes }}</p>
    </div>

    <div *ngIf="currentTab === 'Responsáveis'" class="detail-section">
      <h3>Responsáveis</h3>
      <p><strong>Responsável Técnico:</strong> {{ obra.responsavelTecnicoNome }}</p>
      <p><strong>Equipe:</strong> {{ obra.equipe }}</p>
    </div>

    <div *ngIf="currentTab === 'Status'" class="detail-section">
      <h3>Status dos Serviços</h3>
      <p><strong>Data de Início:</strong> {{ obra.dataInicio | date:'shortDate' }}</p>
      <p><strong>Data de Término:</strong> {{ obra.dataTermino | date:'shortDate' }}</p>
      <p><strong>Status:</strong> {{ getStatusName(obra.status) }}</p>
    </div>

    <div *ngIf="currentTab === 'Manutenção'" class="detail-section">
      <app-manutencao-list
        [obraId]="obra.id!"
        [manutencoes]="obra.manutencoes || []"
        (manutencaoAdded)="refreshManutencoes()"
        (manutencaoDeleted)="refreshManutencoes()">
      </app-manutencao-list>
    </div>

    <div *ngIf="currentTab === 'Diário'" class="detail-section">
      <app-diario-list
        [obraId]="obra.id!"
        [diarios]="obra.diariosObra || []"
        (diarioAdded)="refreshDiarios()"
        (diarioDeleted)="refreshDiarios()">
      </app-diario-list>
    </div>

    <div *ngIf="currentTab === 'Documentos'" class="detail-section">
      <app-documento-list
        [obraId]="obra.id!"
        [documentos]="obra.documentos || []"
        (documentoAdded)="refreshDocumentos()"
        (documentoDeleted)="refreshDocumentos()">
      </app-documento-list>
    </div>
  </div>
</div>