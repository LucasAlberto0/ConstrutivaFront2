<div class="obra-detail-container">
  <div class="obra-header">
    <button class="btn-back" (click)="goBack()">Voltar</button> 
    <h1>{{ obra?.nome }}</h1>
    <p class="obra-location">{{ obra?.localizacao }}</p> 
    <div class="obra-actions">
      <button *ngIf="canEditObra" class="btn btn-primary" (click)="editObra()"> <img src="img/editIcon.svg" alt=""><span>Editar Obra</span></button>
      <button *ngIf="canEditObra" class="btn btn-danger" (click)="deleteObra()"><img src="img/trashIcon.svg" alt=""><span>Excluir Obra</span></button>
    </div>
  </div>

  <div *ngIf="obra && !loading" class="progress-bar-container">
    <div class="bg-progress-bar">
    <div class="progress-bar-label"><h4>Progresso Geral</h4> <h2>{{ progress | number:'1.0-0' }}%</h2></div>
    <div class="progress-bar">
      <div class="progress-bar-fill" [style.width.%]="progress"></div>
    </div></div>
  </div>

  <div class="custom-tab-menu">
    <button (click)="selectTab('Dados Básicos')" [class.active]="currentTab === 'Dados Básicos'">Dados Básicos</button>
    <button (click)="selectTab('Responsáveis')" [class.active]="currentTab === 'Responsáveis'">Responsáveis</button>
    <button (click)="selectTab('Status')" [class.active]="currentTab === 'Status'">Status</button>
    <button (click)="selectTab('Manutenção')" [class.active]="currentTab === 'Manutenção'">Manutenção</button>
    <button (click)="selectTab('Diário')" [class.active]="currentTab === 'Diário'">Diário</button>
    <button (click)="selectTab('Documentos')" [class.active]="currentTab === 'Documentos'">Documentos</button>
  </div>

  <div *ngIf="loading" class="loading-message">Carregando detalhes da obra...</div>
  <div *ngIf="error" class="error-message">{{ error }}</div>

  <div *ngIf="obra && !loading" class="card obra-details-card">
    <div *ngIf="currentTab === 'Dados Básicos'" class="detail-section">
      <h3>Dados Básicos</h3>
      <div class="info-box">
        <p><img src="img/redIcons/nameIconRed.svg" alt="Nome"> <strong>Nome:</strong></p>
        <p>{{ obra.nome }}</p>
      </div>
      <div class="info-box">
        <p><img src="img/localIcon.svg" alt="Localização"> <strong>Localização:</strong></p>
        <p>{{ obra.localizacao }}</p>
      </div>
      <div class="info-box">
        <p><img src="img/redIcons/contractIconRed.svg" alt="Contratante"> <strong>Contratante:</strong></p>
        <p>{{ obra.contratante }}</p>
      </div>
      <div class="info-box">
        <p><img src="img/redIcons/contractIconRed.svg" alt="Contrato"> <strong>Contrato:</strong></p>
        <p>{{ obra.contrato }}</p>
      </div>
      <div class="info-box">
        <p><img src="img/redIcons/contractIconRed.svg" alt="Ordem de Início de Serviço"> <strong>Ordem de Início de Serviço:</strong></p>
        <p>{{ obra.ordemInicioServico }}</p>
      </div>
      <div class="info-box">
        <p><img src="img/redIcons/coordinatorIconRed.svg" alt="Coordenador"> <strong>Coordenador:</strong></p>
        <p>{{ obra.coordenadorNome }}</p>
      </div>
      <div class="info-box">
        <p><img src="img/redIcons/admIconRed.svg" alt="Administrador"> <strong>Administrador:</strong></p>
        <p>{{ obra.administradorNome }}</p>
      </div>
      <div class="info-box full-width">
        <p><img src="img/redIcons/clipboardIconRed.svg" alt="Observações"> <strong>Observações:</strong></p>
        <p>{{ obra.observacoes }}</p>
      </div>
    </div>

    <div *ngIf="currentTab === 'Responsáveis'" class="detail-section">
      <h3>Responsáveis</h3>
      <div class="info-box">
        <p><img src="img/redIcons/engineerIconRed.svg" alt="Responsável Técnico"> <strong>Responsável Técnico:</strong></p>
        <p>{{ obra.responsavelTecnicoNome }}</p>
      </div>
      <div class="info-box">
        <p><img src="img/redIcons/teamIconRed.svg" alt="Equipe"> <strong>Equipe:</strong></p>
        <p>{{ obra.equipe }}</p>
      </div>
    </div>

    <div *ngIf="currentTab === 'Status'" class="detail-section">
      <h3>Status dos Serviços</h3>
      <div class="info-box">
        <p><img src="img/redIcons/calendarIconRed.svg" alt="Data de Início"> <strong>Data de Início:</strong></p>
        <p>{{ obra.dataInicio | date:'shortDate' }}</p>
      </div>
      <div class="info-box">
        <p><img src="img/redIcons/calendarIconRed.svg" alt="Data de Término"> <strong>Data de Término:</strong></p>
        <p>{{ obra.dataTermino | date:'shortDate' }}</p>
      </div>
      <div class="info-box">
        <p><img src="img/redIcons/statusIconRed.svg" alt="Status"> <strong>Status:</strong></p>
        <p>{{ getStatusName(obra.status) }}</p>
      </div>
    </div>

    <div *ngIf="currentTab === 'Manutenção'" class="detail-section">
      <app-manutencao-list
        [obraId]="obra.id!"
        [manutencoes]="obra.manutencoes || []"
        (manutencaoAdded)="refreshManutencoes()"
        (manutencaoDeleted)="refreshManutencoes()">
      </app-manutencao-list>
    </div>

    <div *ngIf="currentTab === 'Diário'" class="detail-section">
      <app-diario-list
        [obraId]="obra.id!"
        [diarios]="obra.diariosObra || []"
        (diarioAdded)="refreshDiarios()"
        (diarioDeleted)="refreshDiarios()">
      </app-diario-list>
    </div>

    <div *ngIf="currentTab === 'Documentos'" class="detail-section">
      <app-documento-list
        [obraId]="obra.id!"
        [documentos]="obra.documentos || []"
        (documentoAdded)="refreshDocumentos()"
        (documentoDeleted)="refreshDocumentos()">
      </app-documento-list>
    </div>
  </div>
</div>